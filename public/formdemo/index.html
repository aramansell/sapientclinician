<!DOCTYPE html>
<html>
<head>
  <title>Create a new scenario:</title>
  <link rel='stylesheet' type='text/css' href='style.css' />
</head>
<body>
  <form id="scenarioForm">
    <div id="assessment">
      <h2>What is the purpose of this assessment:</h2>
      <div id="assessmentContent"></div>
    </div>
    
    <div id="learningTarget">
      <h2>Learning Targets:</h2>
      <div id="learningTargetContent"></div>
      <button type="button" onclick="createInputOnClick()">+ New Learning Target</button>
    </div>
    
    <div id="story">
      <h2>Let's start developing the story:</h2>
      <div id="storyContent"></div> 
    </div> 
    
    <div id="facts">
      <h2>Now let's add in some facts and data:</h2>
      <div id="factsContent"></div> 
    </div> 

    <div id="plan">
      <h2>Now let's create the assessment and plan of the visit:</h2>
      <div id="planContent"></div> 
    </div> 
    <!--
    <div id="rubric">
      <h2>Finally, let's build the rubric:</h2>
      <div id="rubricContent"></div>
    </div>
    -->
    <br><br>
    
    <button type="submit">Submit</button>
  </form>

  <script>
    function createDropdown(parentElement, elementId, elementName, elementType, questionText, options) {
      const container = document.createElement('div');
      const questionElement = document.createElement('p');
      questionElement.textContent = questionText;
      container.appendChild(questionElement);

      const dropdownElement = document.createElement('select');
      dropdownElement.id = elementId;
      dropdownElement.name = elementName;
      dropdownElement.type = elementType;

      for (const option of options) {
        const optionElement = document.createElement('option');
        optionElement.value = option.value;
        optionElement.text = option.text;
        dropdownElement.add(optionElement);
      }
    
      container.appendChild(dropdownElement);
      document.createElement('br');
      parentElement.appendChild(container);
    }

    function createCheckboxGroup(parentElement, groupName, questionText, options) {
      const container = document.createElement('div');
      const questionElement = document.createElement('p');
      questionElement.textContent = questionText;
      container.appendChild(questionElement);

      const checkboxContainer = document.createElement('div');

      for (const option of options) {
        const checkboxWrapper = document.createElement('div');
        const checkboxElement = document.createElement('input');
        checkboxElement.type = 'checkbox';
        checkboxElement.name = groupName;
        checkboxElement.value = option.value;
        checkboxElement.id = `${groupName}-${option.value}`;

        const labelElement = document.createElement('label');
        labelElement.textContent = option.text;
        labelElement.setAttribute('for', `${groupName}-${option.value}`);

        checkboxWrapper.appendChild(checkboxElement);
        checkboxWrapper.appendChild(labelElement);
        checkboxContainer.appendChild(checkboxWrapper);
      }

      container.appendChild(checkboxContainer);
      parentElement.appendChild(container);
    }

  function createTextarea(parentElement, elementId, placeholderText, labelText, rows = 3, cols = 30) {
  const container = document.createElement('div');
  const labelElement = document.createElement('label');
  labelElement.setAttribute('for', elementId);
  labelElement.textContent = labelText;
  container.appendChild(labelElement);
  container.appendChild(document.createElement('br'));

  const textareaElement = document.createElement('textarea');
  textareaElement.setAttribute('id', elementId);
  textareaElement.setAttribute('name', elementId);
  textareaElement.setAttribute('placeholder', placeholderText);
  textareaElement.rows = rows;
  textareaElement.cols = cols;
  textareaElement.style.width = '80%';
  textareaElement.style.padding = '5px';
  container.appendChild(textareaElement);

  parentElement.appendChild(container);
}

function createInput(parentElement, elementId, elementType, placeholderText, labelText) {
  const container = document.createElement('div');
  const labelElement = document.createElement('label');
  labelElement.setAttribute('for', elementId);
  labelElement.textContent = labelText;
  container.appendChild(labelElement);
  container.appendChild(document.createElement('br'));

  const inputElement = document.createElement('input');
  inputElement.setAttribute('type', elementType);
  inputElement.setAttribute('id', elementId);
  inputElement.setAttribute('name', elementId);
  inputElement.setAttribute('placeholder', placeholderText);
  inputElement.style.width = '80%';
  inputElement.style.padding = '5px';
  container.appendChild(inputElement);

  parentElement.appendChild(container);
}

function createInputGroup(parentElement, groupName, questionText, inputs) {
  const container = document.createElement('div');
  const questionElement = document.createElement('p');
  questionElement.textContent = questionText;
  container.appendChild(questionElement);

  for (const input of inputs) {
    if (input.type === 'textarea') {
      createTextarea(
        container,
        `${groupName}-${input.id}`,
        input.placeholder,
        input.label,
        input.rows || 3,
        input.cols || 30
      );
    } else {
      createInput(
        container,
        `${groupName}-${input.id}`,
        input.type,
        input.placeholder,
        input.label
      );
    }
  }

  parentElement.appendChild(container);
}
const assessmentElement = document.getElementById('assessmentContent');

createInput(assessmentElement, 'fileName', 'text', 'Chromic Myeloid Leukemia', 'File Name:');
const purpose = [
  { value: 'Formative Assessment', text: 'Formative Assessment' },
  { value: 'Summative Assessment', text: 'Clinical Reasoning Assessment' },
];
createDropdown(assessmentElement, 'purpose', 'purpose', 'text', 'What Category is this assessment?', purpose);

let objectiveCount = 1;
const learningTargetElement = document.getElementById('learningTargetContent');
function createInputOnClick() {
  const inputGroupOptions = [
    { id: 'LearningObjective', type: 'textarea', placeholder: 'The learner will be able to...', label: `Learning Objective #${objectiveCount} (e.g., submission of accurate diagnosis, patient interviewing knowledge & skills)` },
    { id: 'mastery', type: 'textarea', placeholder: 'Mastery looks like...', label: 'Level 4' },
    { id: 'proficiency', type: 'textarea', placeholder: 'Proficiency looks like...', label: 'Level 3' },
    { id: 'developing', type: 'textarea', placeholder: 'Developing looks like...', label: 'Level 2' },
    { id: 'novice', type: 'textarea', placeholder: 'Novice looks like...', label: 'Level 1' }
  ];

  createInputGroup(learningTargetElement, `objective${objectiveCount}`, '', inputGroupOptions);
  objectiveCount++;
}
createInputOnClick();
createInput(assessmentElement, 'who_is_the_learner', 'text', 'First-year med student', 'Who is the learner?');
createTextarea(assessmentElement, 'Student-facing goal statement', 'Get the correct diagnosis...', 'Student-facing goal statement:');

const storyElement = document.getElementById('storyContent');
const patientGroupOptions = [
  { id: 'name', type: 'text', placeholder: 'Patient Name', label: 'Name:' },
  { id: 'preferedName', type: 'text', placeholder: 'Prefered Name', label: 'Prefered Name:' },
  { id: 'preferedPronouns', type: 'text', placeholder: '', label: 'Pronouns:' },
  { id: 'age', type: 'text', placeholder: 'For example, the patient is 5 weeks or the patient is 32 years old...', label: 'Patient Age:' },
  { id: 'sex', type: 'text', placeholder: 'female', label: 'Sex at birth:' },
  { id: 'message', type: 'textarea', placeholder: 'Sarah is a 14 year old female who woke up with abdominal pain...', label: 'Description/Context:' },
  { id: 'additionalFamilyActors', type: 'textarea', placeholder: 'The patient is accompanied by their seeing eye dog and their parent who has legal custody...', label: 'Relevant Family/Friends Present at Visit:' },
  { id: 'status', type: 'textarea', placeholder: 'The patient is alert and oriented...', label: 'Patient Status:' },
  { id: 'temperment', type: 'textarea', placeholder: 'The patient is distrustful of medical providers...', label: 'Patient Temperment:' },
  { id: 'physicalDisability', type: 'text', placeholder: 'The patient is legally blind...', label: 'Physical Disabilities:' },
  { id: 'IntelectualDisability', type: 'text', placeholder: 'The patient has Down Syndrome...', label: 'Intelectual Disabilities:' }

];
createInputGroup(storyElement, 'patientData', 'Describe the patient:', patientGroupOptions);

const settingOptions = [
    { value: 'OutpatientClinic', text: 'Outpatient Clinic' },
    { value: 'Inpatient', text: 'Inpatient' },
    { value: 'EmergencyRoom', text: 'ER' },
    { value: 'FirstResponder', text: 'First Responder/Rescue' }
    //need to insert logic to get this to skip to a new section if option 4 is chosen.
];
createDropdown(storyElement, 'settingDropdown', 'setting', 'text', 'Setting:', settingOptions);

createInput(storyElement, 'Reason_for_visit', '', 'Patient complains of chest pain and...', 'Reason for visit/chief complaint/chief concern:');
createTextarea(storyElement, 'History_of_Present_Illness', 'The patient complains of persistant chest pain lasting 2 hours... Consider the OLDCARTS mnemonic. ', 'History of Present Illness:', rows = 10,);

const heentReviewOfSymptomsGroupOptions = [
    { id: 'general', type: 'text', placeholder: '', label: 'General/Constitutional:' },
    //{ id: 'head', type: 'text', placeholder: '', label: 'Head:' },
    { id: 'eyes', type: 'text', placeholder: '', label: 'Eyes:' },
    { id: 'ears', type: 'text', placeholder: '', label: 'Ears:' },
    { id: 'nose', type: 'text', placeholder: '', label: 'Nose:' },
    { id: 'throat', type: 'text', placeholder: '', label: 'Throat:' },
    { id: 'respiratory', type: 'text', placeholder: '', label: 'Respiratory:' },
    { id: 'cardiovascular', type: 'text', placeholder: '', label: 'Cardiovascular:' },
    { id: 'gastrointestinal', type: 'text', placeholder: '', label: 'Gastrointestinal:' },
    { id: 'genitourinary', type: 'text', placeholder: '', label: 'Genitourinary:' },
    { id: 'musculoskeletal', type: 'text', placeholder: '', label: 'Musculoskeletal:' },
    { id: 'derm', type: 'text', placeholder: '', label: 'Derm:' },
    { id: 'neurological', type: 'text', placeholder: '', label: 'Neurological:' },
    { id: 'psychiatric', type: 'text', placeholder: '', label: 'Psychiatric:' },
    { id: 'endocrine', type: 'text', placeholder: '', label: 'Endocrine:' },
    { id: 'hematologic', type: 'text', placeholder: '', label: 'Hematologic:' }
];
createInputGroup(storyElement, 'patientData', 'Review of Systems: (include pertinent positives and negatives)', heentReviewOfSymptomsGroupOptions);

//createTextarea(storyElement, 'Pertinent_patient_background', 'The patient works at...', 'Pertinent patient background:');
const socialGroupOptions = [
    { id: 'past_medical', type: 'textarea', placeholder: '', label: 'Past Medical History:' },
    { id: 'family_medical_history', type: 'textarea', placeholder: '', label: 'Family Medical History:' },
    { id: 'social_history', type: 'textarea', placeholder: '', label: 'Social History:' },
    { id: 'social_determinants', type: 'textarea', placeholder: '', label: 'Social Determinants:' },
    { id: 'medications', type: 'textarea', placeholder: '', label: 'Medications:' },
    { id: 'allergic', type: 'textarea', placeholder: '', label: 'Allergies:' }
]
createInputGroup(storyElement, 'historyQuestions', 'Patient History:', socialGroupOptions);

//crate the story details
const factsElement = document.getElementById('factsContent');

createTextarea(factsElement, 'Physical_exam', '', 'Physical Exam Findings:');
const physicalExamGroupOptions = [
    { id: 'vitals', type: 'text', placeholder: 'Include temperature, heart rate, blood pressure, respiratory rate, oxygen saturation', label: 'Vitals:' },
    //{ id: 'headPE', type: 'text', placeholder: '', label: 'Head:' },
    { id: 'generalPE', type: 'text', placeholder: '', label: 'General appearance:' },
    { id: 'HEENTPE', type: 'text', placeholder: '', label: 'HEENT:' },
    { id: 'lungsPE', type: 'text', placeholder: '', label: 'Lungs:' },
    { id: 'heartPE', type: 'text', placeholder: '', label: 'Heart:' },
    { id: 'abdomenPE', type: 'text', placeholder: '', label: 'Abdomen:' },
    //{ id: 'genitourinaryPE', type: 'text', placeholder: '', label: 'Genitourinary:' },
    { id: 'extremitiesPE', type: 'text', placeholder: '', label: 'Extremities:' },
    { id: 'lymphNodesPE', type: 'text', placeholder: '', label: 'Lymph nodes:' },
    { id: 'skinPE', type: 'text', placeholder: '', label: 'Skin:' },
    { id: 'neuroPE', type: 'text', placeholder: '', label: 'Neuro:' },
    { id: 'otherPE', type: 'textarea', placeholder: '', label: 'Other:' }
];
createInputGroup(factsElement, 'physicalExamData', 'Physical Exam Findings: (include pertinent positives and negatives)', physicalExamGroupOptions);

createTextarea(factsElement, 'Data', 'Specify every abnormal test name and abnormal results, all other tests will be populated with normal findings unless specified here.', 'Notable Data: (laboratory/imaging results)', rows=12);

//crate the story details
const planElement = document.getElementById('planContent');
createTextarea(planElement, 'Diagnosis', 'Chronic Myeloid Leukemia', 'Diagnosis (dx):', rows=5);
createTextarea(planElement, 'Addition_diagnosis',  '', 'Differential diagnoses:', rows=5);
createTextarea(planElement, 'Treatment', '', 'Treatment/Intervention:', rows = 5);
createTextarea(planElement, 'Plan',  '', 'Assessment/Plan:', rows=5);

const followupQuestions = [
    { id: 'question1', type: 'text', placeholder: 'What would happen if...', label: 'Question 1' },
    { id: 'question2', type: 'text', placeholder: 'You find out the patient has...', label: 'Question 2' },
    { id: 'question2', type: 'text', placeholder: 'After 6 weeks of treatment...', label: 'Question 3' }
];
createInputGroup(planElement, 'followUpQuestions', 'Questions following the scenerio:', followupQuestions);
/*
//create the story details
const rubricElement = document.getElementById('rubricContent');

  // Create a checkbox group
  const rubricPoints = [
    { value: 'hpi', text: 'Adequately obtained HPI and extrapolated key information.' },
    { value: 'medical_socail_family_history', text: 'Adequately obtained accurate medical/social and family history.' },
    { value: 'medication', text: 'Adequately obtained medication (including non-prescribed).' },
    { value: 'allergies', text: 'Adequately obtained and assessed allergies and severity.' },
    { value: 'physical_exam', text: 'Performed physical exam.' },
    { value: 'key_findings', text: 'Elicited key exam findings (both +/-).' },
    { value: 'workup', text: 'Ordered appropriate diagnostic work-up.' },
    { value: 'diagnostic_findings', text: 'Elicited key diagnostic findings (both +/-).' },
    { value: 'addressed_concerns', text: 'Prioritized and addressed concerns/findings.' },
    { value: 'correct_diagnosis', text: 'Formulated the correct diagnosis and considered appropriate differential diagnoses.' },
    { value: 'treatment_plan', text: 'Formulated assessment and treatment plan.' },
    { value: 'treatment_intervention', text: 'Adequately provided appropriate treatment/intervention.' },
    { value: 'patient_education', text: 'Provided patient education and answered/addressed patient questions.' },
    { value: 'closed_the_loop', text: 'Closed the loop.' }
    
];
createCheckboxGroup(rubricElement, 'purpose', 'How did the learner do:', rubricPoints);

createTextarea(rubricElement, 'create_your_own',  'Add in anything not mentioned above that is important for this scenario...', 'Create your own:', rows=5);
*/
function generateTxtFile() {
  const formData = new FormData(document.getElementById('scenarioForm'));
  let fileContent = '';

  for (const [key, value] of formData.entries()) {
    fileContent += `${key}: ${value}\n\n`;
  }

  const blob = new Blob([fileContent], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.download = 'form-data.txt';
  link.href = url;
  link.click();
}

const form = document.getElementById('scenarioForm');
form.addEventListener('submit', (event) => {
  event.preventDefault();
  generateTxtFile();
});
  </script>
</body>
</html>
